const UserAPIV2="API/V2/User.php",BookAPIV2="API/V2/Book.php",AuthorAPIV2="API/V2/Author.php",ChargesAPIV2="API/V2/Charge.php";var HideFunctions=[EmptyBorrowBook,ResetCharges],ShowFunctions=[ShowCharges,ShowAuthor];function AddCard(t){document.getElementById("ContentBody").appendChild(t)}function CreateCard(t,e,o,r="dark",i="",a=""){var n=document.createElement("div");return n.classList+="card card-"+r+" "+e,n.id=t,n.innerHTML='<div class="card-header" id="Card-'+t+'Header"><h3 class="card-title">'+o+'</h3></div><div class="card-body" id="'+t+'Body">'+i+'</div><div class="card-footer" id="'+t+'Footer">'+a+"</div>",n}function AddNotification(t){document.getElementById("NotificationNumber").innerText=parseInt(document.getElementById("NotificationNumber").innerText)+1,document.getElementById("NotificationNumberNotifications").innerText=parseInt(document.getElementById("NotificationNumber").innerText)+" "+document.getElementById("NotificationNumberNotifications").innerText.split(" ",2)[1],document.getElementById("NotificationDropDown").appendChild(t);var e=document.createElement("div");e.classList="dropdown-divider",document.getElementById("NotificationDropDown").appendChild(e)}function CreateNotification(t,e,o,r){var i=document.createElement("a");return i.href=e,i.id="Notification-"+t,i.classList="dropdown-item",i.innerHTML='<i class="fas '+o+' mr-2"></i>'+r,i}function ReloadView(){for(var t=ContentBody.children,e=0;e<t.length;e++)t[e].style.display="none";for(e=0;e<HideFunctions.length;e++)HideFunctions[e]();const o=document.getElementsByClassName(location.hash.substring(1));for(e=0;e<o.length;e++)o[e].style.display="block";for(e=0;e<ShowFunctions.length;e++)ShowFunctions[e]()}function GetAuthors(t,e,o=!1){for(var r=0;r<t.length;r++)$.post(AuthorAPIV2,{type:"GetAuthor",Identifier:t[r]},function(t){0==o?e.innerText+=t.data.Name+" - ":e.innerHTML+='<a href="#Author" onclick="AuthorID='+t.data.ID+'">'+t.data.Name+"</a>"})}var BorrowBookListNumber=1;function BorrowBookFindBook(){BorrowBookBookIdentifier.value.length<3||$.post(BookAPIV2,{type:"GetBook",Identifier:BorrowBookBookIdentifier.value},function(t){var e=document.getElementById("BorrowingTable").children[1],o=e.insertRow(e.rows.length);o.insertCell(0).innerText=BorrowBookListNumber++,o.insertCell(1).innerText=t.data.Identifier,o.insertCell(2).innerText=t.data.Title,GetAuthors(JSON.parse(t.data.AuthorIDs),o.insertCell(3),!1),o.insertCell(4).innerText="Cancel",BorrowBookBookIdentifier.value=""})}function BorrowBookFindUser(){""!=BorrowBookUserIdentifier.value&&$.post(UserAPIV2,{type:"GetUser",Identifier:BorrowBookUserIdentifier.value},function(t){t.hasOwnProperty("error")||(BorrowBookUserName.value=t.data.Name,BorrowBookUserIdentifierLock.value=t.data.Identifier,BorrowBookUserIdentifier.value="")})}function EmptyBorrowBook(){$("#BorrowingTable tbody tr").remove(),BorrowBookListNumber=1,BorrowBookBookIdentifier.value="",BorrowBookUserIdentifierLock.value="",BorrowBookUserIdentifier.value="",BorrowBookUserName.value=""}var SkipCharges=0;function ResetCharges(){SkipCharges=0}function ShowCharges(){if("#ActiveChargesList"==location.hash||"#AllChargesList"==location.hash){var t="#ActiveChargesList"==location.hash?document.getElementById("ActiveChargesTable"):document.getElementById("AllChargesTable");(t=t.children[1]).innerHTML="",$.post(ChargesAPIV2,{type:"#ActiveChargesList"==location.hash?"ListActiveCharges":"ListCharges",Skip:SkipCharges},function(e){if(!e.hasOwnProperty("error"))for(var o=0;o<e.data.length;o++){var r=t.insertRow(t.rows.length);r.insertCell(0).innerText=e.data[o].ID,r.insertCell(1).innerText=e.data[o].Title,r.insertCell(2).innerText=e.data[o].Name,r.insertCell(3).innerText=e.data[o].BorrowDate,"#ActiveChargesList"!=location.hash&&(r.insertCell(4).innerText=e.data[o].ReturnDate,r.insertCell(5).innerText=1==e.data[o].Active?"Yes":"No")}})}}function LogOut(){$.post(UserAPIV2,{type:"LogOut"},function(t){location.reload()})}var SkipSearch=0;function SearchBooks(){var t=document.getElementById("SearchBookInput").value;return $.post(BookAPIV2,{type:"SearchBook",SearchTag:t,Skip:SkipSearch},function(t){if(t.response){var e=document.getElementById("SearchResultTable").children[1];e.innerHTML="";for(var o=0;o<t.data.length;o++){var r=e.insertRow(e.rows.length);r.insertCell(0).innerText=SkipSearch+o+1,r.insertCell(1).innerText=t.data[o].Identifier,r.insertCell(2).innerText=t.data[o].Title,GetAuthors(JSON.parse(t.data[o].AuthorIDs),r.insertCell(3),!0),r.insertCell(4).innerText=t.data[o].Dewey,r.insertCell(5).innerText=t.data[o].ISBN,r.insertCell(6).innerText=t.data[o].Quantity-t.data[o].QuantityBorrowed}location.hash="#Search"}else console.log("Could not perform the Search")}),!1}var BorrowBookBookIdentifier,BorrowBookUserIdentifier,BorrowBookUserIdentifierLock,BorrowBookUserName,AuthorID=-1;function ShowAuthor(){"#Author"==location.hash&&(-1==AuthorID&&(location.hash=""),$.post(AuthorAPIV2,{type:"GetAuthor",Identifier:AuthorID},function(t){document.getElementById("AuthorName").innerText=t.data.Name,null!=t.data.PictureURL?(document.getElementById("AuthorPictureImg").style.display="block",document.getElementById("AuthorPictureImg").src=t.data.PictureURL):document.getElementById("AuthorPictureImg").style.display="none",document.getElementById("AuthorDescription").innerText=""!=t.data.Description?t.data.Description:"No Author Description"}))}$(function(){AddCard(CreateCard("BorrowBookCard","BorrowBook","Borrow Book","dark",'<div class="row"><div class="col-9"> <input type="text" class="form-control" id="BorrowBookBookIdentifier" placeholder="Book Identifier" autocomplete="off"></div><div class="col-3"> <button type="button" class="btn btn-block btn-dark" onclick="BorrowBookFindBook()">Find Book</button></div></div> <br /><div class="row"><div class="col-12 table-responsive"><table id="BorrowingTable" class="table table-bordered table-striped"><thead><tr><th>#</th><th>Identifier</th><th>Title</th><th>Author</th><th>Action</th></tr></thead><tbody></tbody></table></div></div> <br /><div class="row"><div class="col-9"> <input type="text" class="form-control" id="BorrowBookUserIdentifier" placeholder="User Identifier" autocomplete="off"></div><div class="col-3"> <button type="button" class="btn btn-block btn-dark" onclick="BorrowBookFindUser()">Find User</button></div></div> <br /><div class="row"><div class="col-12" hidden><input type="text" class="form-control" id="BorrowBookUserIdentifierLock" readonly disabled></div></div><div class="row"><div class="col-12"> <input type="text" class="form-control" id="BorrowBookUserName" placeholder="User Name" readonly disabled></div></div>','<button type="button" class="btn btn-block btn-dark" id="BorrowBookBtn" style="width: 100%">Charge</button>')),AddCard(CreateCard("ReturnBookCard","ReturnBook","Return Book","dark",'<div class="row"><div class="col-9"> <input type="text" class="form-control" placeholder="Book Identifier" autocomplete="off"></div><div class="col-3"> <button type="button" class="btn btn-block btn-dark">Find Book</button></div></div> <br /><div class="row"><div class="col-12 table-responsive"><table id="BorrowingTable" class="table table-bordered table-striped"><thead><tr><th>#</th><th>Identifier</th><th>Title</th><th>Author</th><th>Action</th></tr></thead><tbody></tbody></table></div></div>','<button type="button" class="btn btn-block btn-dark" style="width: 100%">Return Books</button>')),AddCard(CreateCard("SearchResultsCard","Search","Search Results","dark",'<div class="col-12 table-responsive"><table id="SearchResultTable" class="table table-bordered table-striped"><thead><tr><th>#</th><th>Identifier</th><th>Title</th><th>Author</th><th>Dewey</th><th>ISBN</th><th>Quantity Available</th></tr></thead><tbody></tbody></table></div>','<div class="row"><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="if (SkipSearch >= 20) { SkipSearch = SkipSearch - 20; SearchBooks(); }">Previous Page</button></div><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="SkipSearch = SkipSearch + 20; SearchBooks();">Next Page</button></div></div>')),AddCard(CreateCard("AuthorCard","Author","Author's Page","dark",'<div class="row"><div class="col-12"><h1 id="AuthorName" style="text-align: center;"></h1></div></div><div class="row"><div class="col-12"><img src="" id="AuthorPictureImg" width="30%" style="margin-left: auto; margin-right: auto;"></div></div><br /><div class="row"><div class="col-12"><p id="AuthorDescription" class="text-justify"></p></div></div>',"")),AddCard(CreateCard("ActiveChargesListCard","ActiveChargesList","Active Charges","dark",'<div class="col-12 table-responsive"><table id="ActiveChargesTable" class="table table-bordered table-striped"><thead><tr><th>Identifier</th><th>Title</th><th>User Name</th><th>Borrowing Date</th></tr></thead><tbody></tbody></table></div>','<div class="row"><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="if (SkipCharges >= 20) { SkipCharges = SkipCharges - 20; ShowCharges(); }">Previous Page</button></div><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="SkipCharges = SkipCharges + 20; ShowCharges();">Next Page</button></div></div>')),AddCard(CreateCard("AllChargesListCard","AllChargesList","All Charges","dark",'<div class="col-12 table-responsive"><table id="AllChargesTable" class="table table-bordered table-striped"><thead><tr><th>Identifier</th><th>Title</th><th>User Name</th><th>Borrowing Date</th><th>Return Date</th><th>Active</th></tr></thead><tbody></tbody></table></div>','<div class="row"><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="if (SkipCharges >= 20) { SkipCharges = SkipCharges - 20; ShowCharges(); }">Previous Page</button></div><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="SkipCharges = SkipCharges + 20; ShowCharges();">Next Page</button></div></div>')),BorrowBookBookIdentifier=document.getElementById("BorrowBookBookIdentifier"),BorrowBookUserIdentifier=document.getElementById("BorrowBookUserIdentifier"),BorrowBookUserIdentifierLock=document.getElementById("BorrowBookUserIdentifierLock"),BorrowBookUserName=document.getElementById("BorrowBookUserName"),window.addEventListener("hashchange",ReloadView,!1),ReloadView()});