const UserAPIV2="API/V2/User.php",BookAPIV2="API/V2/Book.php",AuthorAPIV2="API/V2/Author.php",ChargesAPIV2="API/V2/Charge.php";var HideFunctions=[EmptyBorrowBook,ResetCharges],ShowFunctions=[ShowCharges];function AddCard(e){document.getElementById("ContentBody").appendChild(e)}function CreateCard(e,t,o,r="dark",i="",a=""){var n=document.createElement("div");return n.classList+="card card-"+r+" "+t,n.id=e,n.innerHTML='<div class="card-header" id="Card-'+e+'Header"><h3 class="card-title">'+o+'</h3></div><div class="card-body" id="'+e+'Body">'+i+'</div><div class="card-footer" id="'+e+'Footer">'+a+"</div>",n}function AddNotification(e){document.getElementById("NotificationNumber").innerText=parseInt(document.getElementById("NotificationNumber").innerText)+1,document.getElementById("NotificationNumberNotifications").innerText=parseInt(document.getElementById("NotificationNumber").innerText)+" "+document.getElementById("NotificationNumberNotifications").innerText.split(" ",2)[1],document.getElementById("NotificationDropDown").appendChild(e);var t=document.createElement("div");t.classList="dropdown-divider",document.getElementById("NotificationDropDown").appendChild(t)}function CreateNotification(e,t,o,r){var i=document.createElement("a");return i.href=t,i.id="Notification-"+e,i.classList="dropdown-item",i.innerHTML='<i class="fas '+o+' mr-2"></i>'+r,i}function ReloadView(){for(var e=ContentBody.children,t=0;t<e.length;t++)e[t].style.display="none";for(t=0;t<HideFunctions.length;t++)HideFunctions[t]();const o=document.getElementsByClassName(location.hash.substring(1));for(t=0;t<o.length;t++)o[t].style.display="block";for(t=0;t<ShowFunctions.length;t++)ShowFunctions[t]()}function GetAuthors(e,t,o=!1){for(var r=0;r<e.length;r++)$.post(AuthorAPIV2,{type:"GetAuthor",Identifier:e[r]},function(e){0==o?t.innerText+=e.data.Name+" - ":t.innerHTML+='<a href="#'+e.data.Name+'">'+e.data.Name+"</a>"})}var BorrowBookListNumber=1;function BorrowBookFindBook(){BorrowBookBookIdentifier.value.length<3||$.post(BookAPIV2,{type:"GetBook",Identifier:BorrowBookBookIdentifier.value},function(e){var t=document.getElementById("BorrowingTable").children[1],o=t.insertRow(t.rows.length);o.insertCell(0).innerText=BorrowBookListNumber++,o.insertCell(1).innerText=e.data.Identifier,o.insertCell(2).innerText=e.data.Title,GetAuthors(JSON.parse(e.data.AuthorIDs),o.insertCell(3),!1),o.insertCell(4).innerText="Cancel",BorrowBookBookIdentifier.value=""})}function BorrowBookFindUser(){""!=BorrowBookUserIdentifier.value&&$.post(UserAPIV2,{type:"GetUser",Identifier:BorrowBookUserIdentifier.value},function(e){e.hasOwnProperty("error")||(BorrowBookUserName.value=e.data.Name,BorrowBookUserIdentifierLock.value=e.data.Identifier,BorrowBookUserIdentifier.value="")})}function EmptyBorrowBook(){$("#BorrowingTable tbody tr").remove(),BorrowBookListNumber=1,BorrowBookBookIdentifier.value="",BorrowBookUserIdentifierLock.value="",BorrowBookUserIdentifier.value="",BorrowBookUserName.value=""}var SkipCharges=0;function ResetCharges(){SkipCharges=0}function ShowCharges(){if("#ActiveChargesList"==location.hash||"#AllChargesList"==location.hash){var e="#ActiveChargesList"==location.hash?document.getElementById("ActiveChargesTable"):document.getElementById("AllChargesTable");(e=e.children[1]).innerHTML="",$.post(ChargesAPIV2,{type:"#ActiveChargesList"==location.hash?"ListActiveCharges":"ListCharges",Skip:SkipCharges},function(t){if(!t.hasOwnProperty("error"))for(var o=0;o<t.data.length;o++){var r=e.insertRow(e.rows.length);r.insertCell(0).innerText=t.data[o].ID,r.insertCell(1).innerText=t.data[o].Title,r.insertCell(2).innerText=t.data[o].Name,r.insertCell(3).innerText=t.data[o].BorrowDate,"#ActiveChargesList"!=location.hash&&(r.insertCell(4).innerText=t.data[o].ReturnDate,r.insertCell(5).innerText=1==t.data[o].Active?"Yes":"No")}})}}function LogOut(){$.post(UserAPIV2,{type:"LogOut"},function(e){location.reload()})}var BorrowBookBookIdentifier,BorrowBookUserIdentifier,BorrowBookUserIdentifierLock,BorrowBookUserName,SkipSearch=0;function SearchBooks(){var e=document.getElementById("SearchBookInput").value;return $.post(BookAPIV2,{type:"SearchBook",SearchTag:e,Skip:SkipSearch},function(e){if(e.response){var t=document.getElementById("SearchResultTable").children[1];t.innerHTML="";for(var o=0;o<e.data.length;o++){var r=t.insertRow(t.rows.length);r.insertCell(0).innerText=SkipSearch+o+1,r.insertCell(1).innerText=e.data[o].Identifier,r.insertCell(2).innerText=e.data[o].Title,GetAuthors(JSON.parse(e.data[o].AuthorIDs),r.insertCell(3),!1),r.insertCell(4).innerText=e.data[o].Dewey,r.insertCell(5).innerText=e.data[o].ISBN,r.insertCell(6).innerText=e.data[o].Quantity-e.data[o].QuantityBorrowed}location.hash="#Search"}else console.log("Could not perform the Search")}),!1}$(function(){AddCard(CreateCard("BorrowBookCard","BorrowBook","Borrow Book","dark",'<div class="row"><div class="col-9"> <input type="text" class="form-control" id="BorrowBookBookIdentifier" placeholder="Book Identifier" autocomplete="off"></div><div class="col-3"> <button type="button" class="btn btn-block btn-dark" onclick="BorrowBookFindBook()">Find Book</button></div></div> <br /><div class="row"><div class="col-12 table-responsive"><table id="BorrowingTable" class="table table-bordered table-striped"><thead><tr><th>#</th><th>Identifier</th><th>Title</th><th>Author</th><th>Action</th></tr></thead><tbody></tbody></table></div></div> <br /><div class="row"><div class="col-9"> <input type="text" class="form-control" id="BorrowBookUserIdentifier" placeholder="User Identifier" autocomplete="off"></div><div class="col-3"> <button type="button" class="btn btn-block btn-dark" onclick="BorrowBookFindUser()">Find User</button></div></div> <br /><div class="row"><div class="col-12" hidden><input type="text" class="form-control" id="BorrowBookUserIdentifierLock" readonly disabled></div></div><div class="row"><div class="col-12"> <input type="text" class="form-control" id="BorrowBookUserName" placeholder="User Name" readonly disabled></div></div>','<button type="button" class="btn btn-block btn-dark" id="BorrowBookBtn" style="width: 100%">Charge</button>')),AddCard(CreateCard("ReturnBookCard","ReturnBook","Return Book","dark",'<div class="row"><div class="col-9"> <input type="text" class="form-control" placeholder="Book Identifier" autocomplete="off"></div><div class="col-3"> <button type="button" class="btn btn-block btn-dark">Find Book</button></div></div> <br /><div class="row"><div class="col-12 table-responsive"><table id="BorrowingTable" class="table table-bordered table-striped"><thead><tr><th>#</th><th>Identifier</th><th>Title</th><th>Author</th><th>Action</th></tr></thead><tbody></tbody></table></div></div>','<button type="button" class="btn btn-block btn-dark" style="width: 100%">Return Books</button>')),AddCard(CreateCard("SearchResultsCard","Search","Search Results","dark",'<div class="col-12 table-responsive"><table id="SearchResultTable" class="table table-bordered table-striped"><thead><tr><th>#</th><th>Identifier</th><th>Title</th><th>Author</th><th>Dewey</th><th>ISBN</th><th>Quantity Available</th></tr></thead><tbody></tbody></table></div>','<div class="row"><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="if (SkipSearch >= 20) { SkipSearch = SkipSearch - 20; SearchBooks(); }">Previous Page</button></div><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="SkipSearch = SkipSearch + 20; SearchBooks();">Next Page</button></div></div>')),AddCard(CreateCard("ActiveChargesListCard","ActiveChargesList","Active Charges","dark",'<div class="col-12 table-responsive"><table id="ActiveChargesTable" class="table table-bordered table-striped"><thead><tr><th>Identifier</th><th>Title</th><th>User Name</th><th>Borrowing Date</th></tr></thead><tbody></tbody></table></div>','<div class="row"><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="if (SkipCharges >= 20) { SkipCharges = SkipCharges - 20; ShowCharges(); }">Previous Page</button></div><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="SkipCharges = SkipCharges + 20; ShowCharges();">Next Page</button></div></div>')),AddCard(CreateCard("AllChargesListCard","AllChargesList","All Charges","dark",'<div class="col-12 table-responsive"><table id="AllChargesTable" class="table table-bordered table-striped"><thead><tr><th>Identifier</th><th>Title</th><th>User Name</th><th>Borrowing Date</th><th>Return Date</th><th>Active</th></tr></thead><tbody></tbody></table></div>','<div class="row"><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="if (SkipCharges >= 20) { SkipCharges = SkipCharges - 20; ShowCharges(); }">Previous Page</button></div><div class="col-6"><button type="button" class="btn btn-block btn-primary" onclick="SkipCharges = SkipCharges + 20; ShowCharges();">Next Page</button></div></div>')),BorrowBookBookIdentifier=document.getElementById("BorrowBookBookIdentifier"),BorrowBookUserIdentifier=document.getElementById("BorrowBookUserIdentifier"),BorrowBookUserIdentifierLock=document.getElementById("BorrowBookUserIdentifierLock"),BorrowBookUserName=document.getElementById("BorrowBookUserName"),window.addEventListener("hashchange",ReloadView,!1),ReloadView()});